<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2299.77">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; color: #dbdbdf; -webkit-text-stroke: #dbdbdf; background-color: #131313}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 14.0px Helvetica; color: #dbdbdf; -webkit-text-stroke: #dbdbdf; background-color: #131313; min-height: 17.0px}
    span.s1 {font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"&gt;</span></p>
<p class="p1"><span class="s1">&lt;html&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta http-equiv="Content-Type" content="text/html; charset=utf-8"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta http-equiv="Content-Style-Type" content="text/css"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;title&gt;StoryBali - Mobile Chat&lt;/title&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta name="Generator" content="Cocoa HTML Writer"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;meta name="CocoaVersion" content="2299.77"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>* {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>-webkit-tap-highlight-color: transparent;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-family: 'Poppins', sans-serif;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #f0f2f5 !important; /* Latar belakang abu-abu muda */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>overflow-x: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>margin: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-container {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #f0f2f5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>min-height: 100vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-window {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Shadow lebih lembut */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: slideInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 2rem; /* Sudut lebih melengkung */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 95vh; /* Sedikit lebih kecil dari 100vh */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>max-height: 800px; /* Batasi tinggi untuk desktop */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>max-width: 420px; /* Lebar khas ponsel */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>flex-direction: column;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: relative; /* Untuk swipe indicator */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes slideInUp {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>from {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(30px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>to {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Header Gradient &amp; Shimmer */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.header-gradient {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-top-left-radius: 2rem; /* Ikuti chat-window */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-top-right-radius: 2rem; /* Ikuti chat-window */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.header-gradient::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>content: '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>top: -50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>left: -50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 200%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 200%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.15), transparent); /* Shimmer lebih jelas */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: shimmer 3s infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes shimmer {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>0% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateX(-100%) translateY(-100%) rotate(45deg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>100% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateX(100%) translateY(100%) rotate(45deg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* AI Avatar &amp; Pulse */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.ai-avatar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(135deg, #667eea, #764ba2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: avatarPulse 2s infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 3px solid rgba(255, 255, 255, 0.4); /* Border lebih tebal */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.4); /* Shadow awal */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.ai-avatar::after {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>content: '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>inset: -2px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(45deg, #667eea, #764ba2, #f093fb);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: inherit;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>z-index: -1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: rotate 4s linear infinite;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes avatarPulse {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>0%, 100% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: scale(1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>50% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: scale(1.05);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>box-shadow: 0 0 0 15px rgba(102, 126, 234, 0); /* Pulse lebih besar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes rotate {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>from {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: rotate(0deg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>to {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: rotate(360deg);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Message Bubbles */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.message-bubble {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: messageSlide 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform-origin: bottom left;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>margin-bottom: 1rem; /* Spasi antar pesan */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.message-bubble.user {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform-origin: bottom right;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes messageSlide {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>from {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(20px) scale(0.8);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>to {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(0) scale(1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.ai-message {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #e2e8f0; /* Latar belakang pesan AI lebih terang */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08); /* Shadow lebih lembut */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 1px solid rgba(102, 126, 234, 0.05); /* Border lebih tipis */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 1.25rem; /* Sudut melengkung */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-top-left-radius: 0.375rem; /* Sudut atas kiri lebih kecil */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 1rem; /* Padding lebih konsisten */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>max-width: 85%; /* Lebar pesan */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: relative; /* Untuk tombol speaker */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.user-message {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(135deg, #10b981, #059669);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 1.25rem; /* Sudut melengkung */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-top-right-radius: 0.375rem; /* Sudut atas kanan lebih kecil */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 1rem; /* Padding lebih konsisten */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>max-width: 85%; /* Lebar pesan */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* System Message */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.system-message-bubble {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>margin: 0.5rem 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: messageSlide 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.system-message {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background-color: #e2e8f0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: #4a5568;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-size: 0.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-style: italic;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.25rem 0.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 9999px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Typing Indicator */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.typing-indicator {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>align-items: center; /* Pastikan dot sejajar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>margin-bottom: 1rem; /* Spasi bawah */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.typing-indicator.show {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: fadeInBounce 0.5s ease-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes fadeInBounce {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>0% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(10px) scale(0.8);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>60% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(-2px) scale(1.02);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>100% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: translateY(0) scale(1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.dot {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(135deg, #667eea, #764ba2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: typing 1.4s infinite ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>margin: 0 2px; /* Spasi antar dot */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.dot:nth-child(1) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation-delay: -0.32s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.dot:nth-child(2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation-delay: -0.16s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.dot:nth-child(3) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation-delay: 0s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes typing {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>0%, 80%, 100% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: scale(0.8) translateY(0);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 0.5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>40% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: scale(1.2) translateY(-8px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>opacity: 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Input Area */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.input-area {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-top: 1px solid #e2e8f0; /* Border lebih lembut */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 1rem; /* Padding lebih besar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-bottom-left-radius: 2rem; /* Ikuti chat-window */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-bottom-right-radius: 2rem; /* Ikuti chat-window */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.input-field {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.3s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 2px solid #cbd5e1; /* Border abu-abu */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 9999px; /* Full rounded */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.75rem 1rem; /* Padding lebih baik */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-size: 0.95rem; /* Ukuran font sedikit lebih besar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #f8fafc; /* Latar belakang input */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.input-field:focus {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-color: #667eea;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.2); /* Shadow fokus lebih jelas */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: white; /* Latar belakang putih saat fokus */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.send-button {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(135deg, #667eea, #764ba2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 9999px; /* Full rounded */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 3.25rem; /* Ukuran tombol */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 3.25rem; /* Ukuran tombol */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); /* Shadow tombol kirim */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.send-button::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>content: '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>top: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>left: -100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: left 0.5s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.send-button:hover::before,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.send-button:active::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>left: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.send-button:active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(0.9); /* Animasi klik lebih terasa */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Voice Wave */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.voice-wave {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>gap: 4px; /* Spasi antar bar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 24px; /* Tinggi wave */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.voice-wave.active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.wave-bar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 4px; /* Lebar bar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #667eea;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 2px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: waveAnimation 1s infinite ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.wave-bar:nth-child(2) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation-delay: 0.1s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.wave-bar:nth-child(3) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation-delay: 0.2s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.wave-bar:nth-child(4) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation-delay: 0.3s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.wave-bar:nth-child(5) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation-delay: 0.4s;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes waveAnimation {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>0%, 40%, 100% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: scaleY(0.4);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>20% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>transform: scaleY(1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Quick Actions */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.quick-actions {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>gap: 0.5rem; /* Spasi antar tombol */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.75rem 1rem; /* Padding lebih baik */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-top: 1px solid #e2e8f0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>overflow-x: auto;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scrollbar-width: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>-ms-overflow-style: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: inset 0 -2px 5px rgba(0, 0, 0, 0.03); /* Shadow lembut di bawah quick actions */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.quick-actions::-webkit-scrollbar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.quick-action-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>flex-shrink: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.5rem 1rem; /* Padding lebih baik */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #e0e7ff; /* Latar belakang biru muda */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 1px solid #a7c0ff; /* Border biru */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 9999px; /* Full rounded */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-size: 0.75rem; /* Ukuran font lebih kecil */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-weight: 500;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: #4f46e5; /* Warna teks biru gelap */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.2s ease-in-out; /* Transisi lebih cepat */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* Shadow tombol */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.quick-action-btn:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #c7d2fe; /* Hover lebih gelap */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-color: #6366f1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: translateY(-1px); /* Sedikit naik */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.quick-action-btn:active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #a5b4fc; /* Active lebih gelap */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(0.98); /* Sedikit mengecil */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Suggestion Buttons */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.suggestion-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #f0f2f5; /* Latar belakang abu-abu muda */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 1px solid #cbd5e1; /* Border abu-abu */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 9999px; /* Full rounded */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-size: 0.7rem; /* Ukuran font lebih kecil */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: #4a5568; /* Warna teks abu-abu gelap */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.2s ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.4rem 0.8rem; /* Padding lebih kecil */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.suggestion-btn:hover,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.suggestion-btn:active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #e2e8f0; /* Hover lebih gelap */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-color: #a0aec0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: translateY(-1px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Modals */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.modal-overlay {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: rgba(0, 0, 0, 0.6); /* Overlay lebih gelap */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>backdrop-filter: blur(8px); /* Blur lebih kuat */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: opacity 0.3s ease; /* Animasi fade */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.modal-content {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: rgba(255, 255, 255, 0.98); /* Latar belakang modal lebih solid */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>backdrop-filter: blur(25px); /* Blur lebih kuat */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 1px solid rgba(255, 255, 255, 0.4); /* Border lebih jelas */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 1.5rem; /* Sudut melengkung */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2); /* Shadow lebih besar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(0.9); /* Skala awal */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275),</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>opacity 0.3s ease; /* Animasi bounce */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* NEW SETTINGS MODAL STYLE */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#settingsModal .modal-content {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #f7f8fc;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.modal-overlay.hidden {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>opacity: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>pointer-events: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.modal-overlay:not(.hidden) .modal-content {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>opacity: 1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(1);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.modal-close-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #ef4444; /* Merah */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 2px 8px rgba(239, 68, 68, 0.4); /* Shadow merah */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.2s ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#settingsModal .modal-close-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #e2e8f0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: #475569;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>#settingsModal .modal-close-btn:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #cbd5e1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(1.05);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.modal-close-btn:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #dc2626; /* Merah lebih gelap */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(1.05);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.modal-close-btn:active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(0.95);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.profile-avatar-border {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 4px solid;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-image: linear-gradient(135deg, #667eea, #764ba2, #f093fb) 1; /* Border gradien */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: rotateBorder 4s linear infinite; /* Animasi border */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes rotateBorder {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>0% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-image-source: linear-gradient(135deg, #667eea, #764ba2, #f093fb);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>25% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-image-source: linear-gradient(135deg, #764ba2, #f093fb, #667eea);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>50% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-image-source: linear-gradient(135deg, #f093fb, #667eea, #764ba2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>75% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-image-source: linear-gradient(135deg, #667eea, #764ba2, #f093fb);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>100% {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-image-source: linear-gradient(135deg, #764ba2, #f093fb, #667eea);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* START: NEW SETTINGS UI STYLES */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-tab {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.3s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-bottom: 2px solid transparent;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-tab.active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: #4f46e5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-weight: 600;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-bottom-color: #4f46e5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-tab-content {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animation: fadeIn 0.5s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-tab-content.active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: block;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@keyframes fadeIn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>from { opacity: 0; transform: translateY(10px); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>to { opacity: 1; transform: translateY(0); }</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-card {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.3s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-card:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: translateY(-2px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-item {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>justify-content: space-between;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.75rem 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-bottom: 1px solid #f1f5f9;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-item:last-child {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-bottom: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-icon {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 1.25rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 1.25rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>color: #6366f1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-input, .settings-select {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background: #f8fafc;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 1px solid #e2e8f0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.5rem 0.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-size: 0.875rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.2s ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 55%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-input:focus, .settings-select:focus {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-color: #6366f1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>outline: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-btn-action {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>display: flex;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>align-items: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>justify-content: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>gap: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 0.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>font-weight: 500;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.2s ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-btn-action:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: translateY(-1px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.settings-btn-action:active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: scale(0.98);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.theme-option-new {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 0.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>padding: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border: 2px solid transparent;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: all 0.2s ease-in-out;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>cursor: pointer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>text-align: center;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.theme-option-new.active {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-color: #4f46e5;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background-color: #eef2ff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.theme-swatch {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 100%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 1.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>margin-bottom: 0.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.toggle-new {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>appearance: none;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 44px; /* Slightly wider */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 24px; /* Slightly taller */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 12px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background-color: #cbd5e1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: relative;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>cursor: pointer;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: background-color 0.3s ease;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.toggle-new::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>content: '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>position: absolute;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>top: 3px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>left: 3px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>width: 18px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>height: 18px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>border-radius: 50%;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background-color: white;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>box-shadow: 0 1px 3px rgba(0,0,0,0.2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.toggle-new:checked {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>background-color: #6366f1;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.toggle-new:checked::before {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>transform: translateX(20px);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* END: NEW SETTINGS UI STYLES */</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Mobile optimizations */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>@media (max-width: 768px) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.chat-window {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 0; /* Full screen on mobile */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 100vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>max-height: 100vh;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>max-width: 100vw;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.header-gradient {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-top-left-radius: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-top-right-radius: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.input-area {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-bottom-left-radius: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-bottom-right-radius: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.message-bubble {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>margin-bottom: 0.75rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.ai-message, .user-message {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>max-width: 90%; /* Lebih lebar di mobile */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0.8rem 1.2rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.input-field {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 1rem; /* Prevents zoom on iOS */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0.6rem 1rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.send-button {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>width: 3rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>height: 3rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.quick-actions {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0.6rem 0.8rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.quick-action-btn {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0.4rem 0.8rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>font-size: 0.7rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>.modal-content {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>border-radius: 1rem; /* Sedikit lebih kecil di mobile */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 1.5rem;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>#settingsModal .modal-content {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>padding: 0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* CSS tambahan untuk UI enhancement */</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* Scrollbar styling for chat messages */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-messages::-webkit-scrollbar {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>width: 8px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-messages::-webkit-scrollbar-track {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: transparent; /* Track transparan */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-messages::-webkit-scrollbar-thumb {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-color: rgba(0, 0, 0, 0.2); /* Warna thumb */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 20px; /* Bentuk rounded */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border: 2px solid transparent; /* Border transparan */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-clip: content-box; /* Pastikan background clip ke content box */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-messages::-webkit-scrollbar-thumb:hover {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background-color: rgba(0, 0, 0, 0.3); /* Warna thumb saat hover */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* General container styling for a lifted effect */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-container {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 24px;<span class="Apple-converted-space">    </span>/* atur sudut melengkung */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>overflow: hidden; <span class="Apple-converted-space">      </span>/* biar isi dalam ikut melengkung */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>box-shadow: 0 6px 20px rgba(0,0,0,0.15); /* opsional bayangan */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;style&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* hilangkan background bawaan Canva di wrapper besar */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>html, body {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: transparent !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* kadang Canva bikin pembungkus */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.page,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.wrapper,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.main-container,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.container,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.app-container {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: transparent !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>/* kotak chat tetap putih &amp; melengkung */</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>.chat-container {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>background: #ffffff;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>border-radius: 24px;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>overflow: hidden;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">      </span>box-shadow: 0 6px 20px rgba(0,0,0,0.15);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">  </span>&lt;/style&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1">&lt;div class="chat-container"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div class="chat-window flex flex-col"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Header --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="header-gradient p-4 text-white relative flex-shrink-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex items-center justify-between"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="ai-avatar w-12 h-12 rounded-full flex items-center justify-center overflow-hidden relative cursor-pointer"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                         </span>onclick="showProfileModal()"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;img src="https://i.postimg.cc/Wz2Gmx8X/IMG-2621.jpg" alt="StoryBali"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>class="w-full h-full object-cover"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="status-indicator"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h1 class="text-xl font-bold"&gt;Wayan AI&lt;/h1&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-blue-100 text-sm opacity-90"&gt;Klik untuk lihat profil&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex items-center space-x-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="toggleVoiceMode()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all duration-200 ease-in-out transform hover:scale-105 active:scale-95"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                  </span>d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="toggleSettings()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="w-10 h-10 bg-white bg-opacity-20 rounded-full flex items-center justify-center hover:bg-opacity-30 transition-all duration-200 ease-in-out transform hover:scale-105 active:scale-95"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Quick Actions --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="quick-actions flex-shrink-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button class="quick-action-btn" onclick="sendQuickMessage('Halo Wayan!')"&gt;Halo&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button class="quick-action-btn" onclick="sendQuickMessage('Apa kabar hari ini?')"&gt;Apa kabar?&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button class="quick-action-btn" onclick="sendQuickMessage('Ceritakan joke lucu dong!')"&gt;Joke&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button class="quick-action-btn" onclick="sendQuickMessage('Kasih tips produktif dong!')"&gt;Tips Produktif&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button class="quick-action-btn" onclick="sendQuickMessage('Rekomendasi film bagus dong!')"&gt;Film&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;button class="quick-action-btn" onclick="sendQuickMessage('Ajarin coding dong!')"&gt;Coding&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Chat Messages --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div id="chatMessages" class="flex-1 overflow-y-auto p-4 chat-messages"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="message-bubble flex items-start space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img src="https://i.postimg.cc/Wz2Gmx8X/IMG-2621.jpg" alt="StoryBali" class="w-full h-full object-cover"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-message rounded-2xl rounded-tl-md p-4 max-w-xs relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-gray-800 leading-relaxed text-sm"&gt;Halo! Gue Wayan nih, AI assistant yang siap bantu jawab pertanyaan kamu. Santai aja, tanya apa aja yang kamu mau tau ya!&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- Suggestions will be generated here --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;!-- Tombol Pembaca Jawaban AI &amp; Copy --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="readAiResponse(this, 'SGFsbyEgR3VlIFdheWFuIG5paCwgQUkgYXNzaXN0YW50IHlhbmcgc2lhcCBiYW50dSBqYXdhYiBwZXJ0YW55YW4ga2FtdS4gU2FudGFpIGFqYSwgdGFueWEgYXBhIGFqYSB5YW4nZyBrYW11IG1hdSB0YXUgeWEh')" class="absolute bottom-2 right-2 w-6 h-6 bg-gray-200 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors duration-200 ease-in-out transform hover:scale-110 active:scale-90" title="Baca Jawaban"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.647 11 4.101 11 5v14c0 .899-.077 1.353-.293 1.569l-4.707-4.707z"&gt;&lt;/path&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Typing Indicator --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="typingIndicator" class="typing-indicator items-start space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img src="https://i.postimg.cc/Wz2Gmx8X/IMG-2621.jpg" alt="StoryBali" class="w-full h-full object-cover"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-message rounded-2xl rounded-tl-md p-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex space-x-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="dot"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="dot"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="dot"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Image Processing Indicator --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="imageProcessingIndicator" class="typing-indicator items-start space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img src="https://i.postimg.cc/Wz2Gmx8X/IMG-2621.jpg" alt="StoryBali" class="w-full h-full object-cover"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-message rounded-2xl rounded-tl-md p-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="flex space-x-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="dot"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="dot"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="dot"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;span class="ml-2 text-gray-600 text-sm"&gt;Menganalisis gambar...&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;!-- Input Area --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="input-area flex-shrink-0"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex space-x-3 items-end"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex-1 relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>type="text"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>id="messageInput"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>placeholder="Tanya kepada Wayan AI..."</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="input-field w-full focus:outline-none text-gray-800 placeholder-gray-500"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>onkeypress="handleKeyPress(event)"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center space-x-1"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;button onclick="triggerImageUpload()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>class="text-gray-400 hover:text-blue-500 transition-colors p-1 rounded-full transform hover:scale-110 active:scale-90"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>title="Upload gambar"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                      </span>d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;input type="file" id="imageInput" accept="image/*" style="display: none;"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                           </span>onchange="handleImageUpload(event)"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>onclick="sendMessage()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="send-button text-white flex items-center justify-center"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                              </span>d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Voice Wave Animation --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div id="voiceWave" class="voice-wave justify-center mt-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="wave-bar"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="wave-bar"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="wave-bar"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="wave-bar"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="wave-bar"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Image Preview Modal --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="imagePreviewModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden p-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="modal-content p-6 max-w-sm w-full"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>id="imagePreviewContent"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="text-center relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onclick="hideImagePreview()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="absolute -top-2 -right-2 w-8 h-8 rounded-full flex items-center justify-center shadow-lg modal-close-btn"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img id="previewImage" src="" alt="Preview" class="w-full h-auto rounded-lg max-h-48 object-cover mx-auto shadow-md"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p id="previewFileName" class="text-sm text-gray-600 mt-2"&gt;&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="mb-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;label class="block text-left text-sm font-medium text-gray-700 mb-2"&gt;Tanya sesuatu tentang gambar</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>ini:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;textarea</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>id="imageQuestionInput"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>placeholder="Contoh: Apa yang ada di gambar ini? Jelaskan detail yang kamu lihat..."</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 resize-none text-sm settings-input"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>rows="3"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&gt;&lt;/textarea&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="hideImagePreview()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="flex-1 bg-gray-500 text-white py-3 rounded-xl font-semibold text-sm settings-btn"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Batal</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="sendImageWithQuestion()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>class="flex-1 bg-gradient-to-r from-blue-500 to-purple-500 text-white py-3 rounded-xl font-semibold text-sm settings-btn"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Kirim</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="swipe-indicator"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- Profile Modal --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="profileModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden p-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="modal-content p-6 max-w-sm w-full"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>id="profileModalContent"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="text-center relative"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onclick="hideProfileModal()"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>class="absolute -top-2 -right-2 w-8 h-8 rounded-full flex items-center justify-center shadow-lg modal-close-btn"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-4 h-4 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="w-20 h-20 mx-auto mb-4 rounded-full overflow-hidden profile-avatar-border shadow-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img src="https://i.postimg.cc/Wz2Gmx8X/IMG-2621.jpg" alt="StoryBali" class="w-full h-full object-cover"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt; &lt;!-- Corrected alt text --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h2 class="text-xl font-bold text-gray-800 mb-2"&gt;Wayan AI&lt;/h2&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-purple-600 font-semibold mb-4 text-sm"&gt;AI Assistant Dari Storybali&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="text-gray-600 text-xs leading-relaxed mb-4 text-left bg-gray-50 p-3 rounded-xl"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="mb-2"&gt;&lt;strong&gt;Halo! Gue Wayan!&lt;/strong&gt;&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="mb-2"&gt;Gue adalah AI assistant yang dibuat khusus untuk membantu kamu dengan gaya bahasa yang santai dan friendly.&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p&gt;Santai aja, tanya apa aja yang kamu mau!&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space"> </span>&lt;p&gt;kepoin wayan yuk di instagram atau chat wa pribadi wayan!&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="grid grid-cols-2 gap-2 text-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;a href="https://www.instagram.com/sudiarsana_wayan?igsh=MXE4NHFvZzAyOXd6NQ%3D%3D&amp;utm_source=qr" target="_blank"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="bg-gradient-to-r from-pink-500 to-purple-600 text-white px-3 py-2 rounded-full settings-btn"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>Instagram</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/a&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;a href="https://wa.me/message/RNPBCG25N5V2A1" target="_blank"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                       </span>class="bg-gradient-to-r from-green-500 to-green-600 text-white px-3 py-2 rounded-full settings-btn"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>WhatsApp</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/a&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="swipe-indicator"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- START: UPDATED SETTINGS MODAL --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;div id="settingsModal" class="fixed inset-0 modal-overlay z-50 flex items-center justify-center hidden p-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;div class="modal-content max-w-sm w-full max-h-[90vh] overflow-hidden flex flex-col" id="settingsModalContent"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Modal Header --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="p-4 flex items-center justify-between flex-shrink-0 bg-white border-b border-gray-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;h3 class="text-lg font-bold text-gray-800"&gt;Pengaturan&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onclick="toggleSettings()" class="w-8 h-8 rounded-full flex items-center justify-center shadow-lg modal-close-btn"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Tab Navigation --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex-shrink-0 bg-white border-b border-gray-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;nav class="flex justify-around text-sm text-gray-600"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="switchSettingsTab('general')" class="settings-tab active flex-1 py-3 px-2 text-center"&gt;Umum&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="switchSettingsTab('appearance')" class="settings-tab flex-1 py-3 px-2 text-center"&gt;Tampilan&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="switchSettingsTab('advanced')" class="settings-tab flex-1 py-3 px-2 text-center"&gt;Lanjutan&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/nav&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Tab Content --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex-1 overflow-y-auto p-4 space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- General Tab --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="tab-general" class="settings-tab-content active space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="settings-card"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Nama AI&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="text" id="aiNameInput" value="Wayan AI" class="settings-input text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5h12M9 3v2m4 0v2M3 19h18M5 15h14M9 11h6"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Bahasa&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="languageSelect" class="settings-select text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="id"&gt;Indonesia&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="en"&gt;English&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Gaya Bahasa&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="personalitySelect" class="settings-select text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="santai" selected&gt;Santai&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="profesional"&gt;Profesional&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="lucu"&gt;Humoris&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="settings-card"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5h1.586a1 1 0 01.707.293l2.414 2.414a1 1 0 01.293.707V21H9z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Mode Peran AI&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="aiRoleSelect" class="settings-select text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="umum" selected&gt;Asisten Umum&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="guru_jepang"&gt;Guru B. Jepang&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="guru_matematika"&gt;Guru Matematika&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="dokter"&gt;Dokter Umum&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="programmer"&gt;Programmer&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="penerjemah"&gt;Penerjemah&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="kustom"&gt;Kustom...&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div id="customRoleContainer" class="hidden p-2 mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;label class="block text-xs text-gray-600 mb-1"&gt;Definisikan peran kustom AI:&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;textarea id="customRoleInput" placeholder="Contoh: Kamu adalah seorang ahli sejarah..." class="w-full settings-input text-sm" rows="3"&gt;&lt;/textarea&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Appearance Tab --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="tab-appearance" class="settings-tab-content space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="settings-card"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="p-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;h4 class="text-sm font-medium text-gray-700 mb-3"&gt;Tema Warna&lt;/h4&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="grid grid-cols-3 gap-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div onclick="changeTheme('blue')" id="themeBlue" class="theme-option-new active"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div class="theme-swatch bg-gradient-to-r from-blue-500 to-purple-500"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span class="text-xs font-medium text-gray-600"&gt;Biru&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div onclick="changeTheme('green')" id="themeGreen" class="theme-option-new"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div class="theme-swatch bg-gradient-to-r from-green-500 to-teal-500"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span class="text-xs font-medium text-gray-600"&gt;Hijau&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;div onclick="changeTheme('pink')" id="themePink" class="theme-option-new"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;div class="theme-swatch bg-gradient-to-r from-pink-500 to-red-500"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>&lt;span class="text-xs font-medium text-gray-600"&gt;Pink&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="settings-card"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.75 17L9 20l-1 1h8l-1-1-.75-3M3 13h18M5 17h14a2 2 0 002-2V5a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Ukuran Font&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;select id="fontSizeSelect" class="settings-select text-right w-auto"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="sm"&gt;Kecil&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="base" selected&gt;Normal&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value="lg"&gt;Besar&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Efek Animasi&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="checkbox" id="animationToggle" class="toggle-new" onchange="toggleAnimations()" checked&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="settings-card"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.647 11 4.101 11 5v14c0 .899-.077 1.353-.293 1.569l-4.707-4.707z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Suara Notifikasi&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="checkbox" id="soundToggle" class="toggle-new" onchange="toggleSound()" checked&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Pembaca Jawaban&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="checkbox" id="readAiResponseToggle" class="toggle-new" onchange="toggleReadAiResponse()" checked&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- START: PENAMBAHAN DROPDOWN SUARA --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Jenis Suara&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;select id="voiceSelect" class="settings-select text-right"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;option value=""&gt;Memuat suara...&lt;/option&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;/select&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- END: PENAMBAHAN DROPDOWN SUARA --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;!-- Advanced Tab --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div id="tab-advanced" class="settings-tab-content space-y-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                     </span>&lt;div class="settings-card"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="settings-item"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div class="flex items-center space-x-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="settings-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"&gt;&lt;/path&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 10h.01M15 10h.01M9 14h.01M15 14h.01"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="text-sm font-medium text-gray-700"&gt;Simpan Riwayat&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;input type="checkbox" id="saveHistoryToggle" class="toggle-new" checked&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="p-2 space-y-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;button onclick="exportChatHistory()" class="settings-btn-action bg-green-100 text-green-700 hover:bg-green-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;span&gt;Export Riwayat (.txt)&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;button onclick="clearChatHistory()" class="settings-btn-action bg-red-100 text-red-700 hover:bg-red-200"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;span&gt;Hapus Riwayat Chat&lt;/span&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="settings-card p-4"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;h4 class="text-sm font-semibold text-gray-800 mb-3"&gt;API Keys (Gemini)&lt;/h4&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;div class="space-y-2 text-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-xs text-gray-500 mb-1"&gt;API Key 1 (Utama)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;input type="password" id="apiKey1" placeholder="Masukkan API Key" class="settings-input w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-xs text-gray-500 mb-1"&gt;API Key 2 (Cadangan)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;input type="password" id="apiKey2" placeholder="Opsional" class="settings-input w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-xs text-gray-500 mb-1"&gt;API Key 3 (Cadangan)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;input type="password" id="apiKey3" placeholder="Opsional" class="settings-input w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-xs text-gray-500 mb-1"&gt;API Key 4 (Cadangan)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;input type="password" id="apiKey4" placeholder="Opsional" class="settings-input w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                             </span>&lt;div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;label class="block text-xs text-gray-500 mb-1"&gt;API Key 5 (Cadangan)&lt;/label&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>&lt;input type="password" id="apiKey5" placeholder="Opsional" class="settings-input w-full"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;button onclick="saveApiKeys()" class="w-full settings-btn-action bg-blue-600 text-white mt-4 hover:bg-blue-700"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>Simpan API Keys</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;!-- Modal Footer --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="p-3 bg-white border-t border-gray-200 flex-shrink-0 text-center"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;p class="text-xs text-gray-500"&gt;StoryBali v2.2 | © 2024&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- END: UPDATED SETTINGS MODAL --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>&lt;!-- ================================================================= --&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1">&lt;script&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Variabel Global</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let apiKeys = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let conversationHistory = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let isVoiceMode = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let recognition = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// --- START: PENGATURAN FITUR BATAS CHAT ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const CHAT_LIMIT = 4; // Batas jumlah chat</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const COOLDOWN_MINUTES =1; // Durasi cooldown dalam menit</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let currentUserIP = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let countdownInterval = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// --- END: PENGATURAN FITUR BATAS CHAT ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Settings</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let settings = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>theme: 'blue',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>soundEnabled: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>animationsEnabled: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>readAiResponseEnabled: true,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>personality: 'santai',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>aiRole: 'umum', // Properti baru untuk peran</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>customAiRolePrompt: '', // Properti baru untuk menyimpan prompt kustom</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>voiceURI: '' // Properti baru untuk menyimpan suara pilihan</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Variables for AI response reader</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let currentUtterance = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let isReading = false;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// ==================================================================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// TEMPAT UNTUK MENGISI API KEY ANDA</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Ganti 'YOUR_GEMINI_API_KEY_X' dengan API Key Google Gemini Anda yang sebenarnya.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// ==================================================================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const DEFAULT_API_KEY_1 = 'AIzaSyClcqSMaHiXMZI4qYlTySqC3I3hWWg8H9s'; // Ganti dengan kunci asli Anda</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const DEFAULT_API_KEY_2 = 'AIzaSyB8OPwzNAAyO1nWd9g185rx4YK3WIJy_Fw'; // Ganti dengan kunci asli Anda</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const DEFAULT_API_KEY_3 = 'AIzaSyAYzvB1mfVdjrBtXY2n4-UUzCH5juQt8rU'; // Ganti dengan kunci asli Anda</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const DEFAULT_API_KEY_4 = 'AIzaSyCkkekhKcQzFUUjx8ZcuqEYyqRde1ZDJcU'; // Ganti dengan kunci asli Anda</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>const DEFAULT_API_KEY_5 = 'AIzaSyCV-88PX1_tKh5VBjki9VeyY8gAH5bpZ0o'; // Ganti dengan kunci asli Anda</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// ==================================================================================================================</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// --- START: FUNGSI BARU UNTUK BATAS CHAT ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Fungsi untuk mendapatkan IP pengguna dari API eksternal</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>async function getUserIP() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const response = await fetch('https://api.ipify.org?format=json');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!response.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>throw new Error('Gagal mendapatkan IP');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const data = await response.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return data.ip;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.error("Tidak bisa mendapatkan IP address:", error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Fallback jika API gagal, menggunakan nilai default (kurang ideal, tapi mencegah error)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return 'default_user';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Mendapatkan data limit chat dari localStorage</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function getChatLimitData() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const data = localStorage.getItem('wayanAiChatLimit');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return data ? JSON.parse(data) : {};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Menyimpan data limit chat ke localStorage</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function saveChatLimitData(data) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>localStorage.setItem('wayanAiChatLimit', JSON.stringify(data));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Memeriksa status pengguna saat ini (apakah di cooldown atau tidak)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function checkUserStatus() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!currentUserIP) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const allUserData = getChatLimitData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const userData = allUserData[currentUserIP];</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (userData &amp;&amp; userData.cooldownUntil &amp;&amp; new Date().getTime() &lt; userData.cooldownUntil) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Jika pengguna masih dalam masa cooldown</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>startCooldown(userData.cooldownUntil);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else if (userData) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Jika cooldown sudah berakhir, hapus data lama</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>delete allUserData[currentUserIP];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveChatLimitData(allUserData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Mengaktifkan atau menonaktifkan input area</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function setInputEnabled(enabled, message = "Tanya kepada Wayan AI...") {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const messageInput = document.getElementById('messageInput');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const sendButton = document.querySelector('.send-button');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const imageUploadButton = document.querySelector('button[onclick="triggerImageUpload()"]');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>messageInput.disabled = !enabled;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>sendButton.disabled = !enabled;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>imageUploadButton.disabled = !enabled;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>messageInput.placeholder = message;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!enabled) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sendButton.style.opacity = '0.5';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sendButton.style.cursor = 'not-allowed';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>imageUploadButton.style.opacity = '0.5';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sendButton.style.opacity = '1';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sendButton.style.cursor = 'pointer';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>imageUploadButton.style.opacity = '1';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Memulai periode cooldown</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function startCooldown(cooldownEndTime) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setInputEnabled(false, "Anda mencapai batas limit. Silakan tunggu...");</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const messageId = `cooldown-timer-${currentUserIP}`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Hapus timer lama jika ada, untuk memastikan notifikasi baru muncul di bawah</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const oldTimerMessage = document.getElementById(messageId);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if(oldTimerMessage) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>oldTimerMessage.remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Selalu buat elemen pesan baru untuk timer</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const timerMessageElement = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>timerMessageElement.className = 'system-message-bubble';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>timerMessageElement.id = messageId; // Beri ID agar bisa diupdate</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>chatMessages.insertBefore(timerMessageElement, document.getElementById('typingIndicator'));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Panggil scroll sekali saat pesan dibuat, setelah itu jangan lagi</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scrollToBottom();<span class="Apple-converted-space"> </span></span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (countdownInterval) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>clearInterval(countdownInterval);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>countdownInterval = setInterval(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const now = new Date().getTime();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const distance = cooldownEndTime - now;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (distance &lt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>endCooldown();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const seconds = Math.floor((distance % (1000 * 60)) / 1000);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Perbarui innerHTML tanpa memanggil scrollToBottom()</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>timerMessageElement.innerHTML = `&lt;div class="system-message"&gt;Anda mencapai batas limit mengirim chat. Kembali setelah ${minutes}m ${seconds}s lagi.&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}, 1000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Mengakhiri periode cooldown</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function endCooldown() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>clearInterval(countdownInterval);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>countdownInterval = null;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const timerMessageElement = document.getElementById(`cooldown-timer-${currentUserIP}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (timerMessageElement) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>timerMessageElement.innerHTML = `&lt;div class="system-message"&gt;Anda sudah bisa mengobrol lagi!&lt;/div&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Hapus data pengguna dari localStorage</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const allUserData = getChatLimitData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (allUserData[currentUserIP]) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>delete allUserData[currentUserIP];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveChatLimitData(allUserData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setInputEnabled(true);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// --- END: FUNGSI BARU UNTUK BATAS CHAT ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// API Key Management</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function saveApiKeys() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const keysToSave = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>for (let i = 1; i &lt;= 5; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const key = document.getElementById(`apiKey${i}`).value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>keysToSave.push(key);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>localStorage.setItem('storybaliApiKeys', JSON.stringify(keysToSave));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>alert('API Keys berhasil disimpan!');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loadApiKeys();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateApiStatus();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function loadApiKeys() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const savedKeys = localStorage.getItem('storybaliApiKeys');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (savedKeys) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>apiKeys = JSON.parse(savedKeys);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>for (let i = 0; i &lt; apiKeys.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const inputElement = document.getElementById(`apiKey${i + 1}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (inputElement) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>inputElement.value = apiKeys[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>apiKeys = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>DEFAULT_API_KEY_1,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>DEFAULT_API_KEY_2,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>DEFAULT_API_KEY_3,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>DEFAULT_API_KEY_4,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>DEFAULT_API_KEY_5</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>for (let i = 0; i &lt; apiKeys.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const inputElement = document.getElementById(`apiKey${i + 1}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (inputElement) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>inputElement.value = apiKeys[i];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function updateApiStatus() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const hasValidKey = apiKeys.some(key =&gt; key &amp;&amp; !key.startsWith('YOUR_GEMINI_API_KEY_'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function updateChatCount() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const totalChats = conversationHistory.filter(msg =&gt; msg.role === 'user').length;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Export Chat History</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function exportChatHistory() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (conversationHistory.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('Belum ada riwayat chat untuk di-export!');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let exportText = '=== Wayan AI CHAT HISTORY ===\n\n';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>exportText += `Exported: ${new Date().toLocaleString('id-ID')}\n\n`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>conversationHistory.forEach((msg) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const role = msg.role === 'user' ? 'Kamu' : 'Wayan AI';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const text = msg.parts[0].text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>exportText += `${role}: ${text}\n\n`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const blob = new Blob([exportText], {type: 'text/plain'});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const url = URL.createObjectURL(blob);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const a = document.createElement('a');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>a.href = url;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>a.download = `wayan-ai-chat-${new Date().toISOString().split('T')[0]}.txt`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.body.appendChild(a);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>a.click();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.body.removeChild(a);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>URL.revokeObjectURL(url);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>alert('Chat history berhasil di-export!');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Animation Toggle</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function toggleAnimations() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>settings.animationsEnabled = document.getElementById('animationToggle').checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const style = document.createElement('style');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!settings.animationsEnabled) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>style.textContent = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>*, *::before, *::after {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>animation-duration: 0.01ms !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>animation-iteration-count: 1 !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>transition-duration: 0.01ms !important;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>style.id = 'animation-disable';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const existingStyle = document.getElementById('animation-disable');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (existingStyle) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>existingStyle.remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!settings.animationsEnabled) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.head.appendChild(style);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// START: PERUBAHAN - Penggunaan API Key Acak</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function getCurrentApiKey() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (apiKeys.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>loadApiKeys();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Filter hanya API key yang valid (bukan placeholder)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const validApiKeys = apiKeys.filter(key =&gt; key &amp;&amp; !key.startsWith('YOUR_GEMINI_API_KEY_'));</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (validApiKeys.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.warn("Tidak ada API Key yang valid ditemukan. Pastikan Anda telah memasukkan API Key di pengaturan.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Pilih satu API key secara acak dari daftar yang valid</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const randomIndex = Math.floor(Math.random() * validApiKeys.length);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>console.log(`Menggunakan API Key acak index: ${randomIndex}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return validApiKeys[randomIndex];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Fungsi switchToNextApiKey() sudah tidak relevan lagi karena pemilihan bersifat acak setiap saat.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Kita akan menangani error API dengan cara me-retry, yang secara otomatis akan memanggil getCurrentApiKey() lagi untuk mendapatkan kunci acak (bisa sama, bisa beda).</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// END: PERUBAHAN - Penggunaan API Key Acak</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function getApiUrl() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const apiKey = getCurrentApiKey();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!apiKey) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return null;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash-latest:generateContent?key=${apiKey}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Conversation Memory</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function saveConversationHistory() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (document.getElementById('saveHistoryToggle').checked) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>localStorage.setItem('storybaliConversationHistory', JSON.stringify(conversationHistory));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function loadConversationHistory() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const savedHistory = localStorage.getItem('storybaliConversationHistory');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (savedHistory) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conversationHistory = JSON.parse(savedHistory);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conversationHistory.forEach(msg =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (msg.role === 'user') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>addMessage(msg.parts[0].text, true);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>addMessage(msg.parts[0].text, false);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function addToConversationHistory(role, message) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>conversationHistory.push({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>role: role,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>parts: [{text: message}]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (conversationHistory.length &gt; 20) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conversationHistory = conversationHistory.slice(-20);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveConversationHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateChatCount();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Quick Messages</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function sendQuickMessage(message) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('messageInput').value = message;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>sendMessage();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Voice Mode</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function toggleVoiceMode() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>isVoiceMode = !isVoiceMode;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const voiceWave = document.getElementById('voiceWave');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (isVoiceMode) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>startVoiceRecognition();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>voiceWave.classList.add('active');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>stopVoiceRecognition();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>voiceWave.classList.remove('active');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function startVoiceRecognition() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if ('webkitSpeechRecognition' in window) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition = new webkitSpeechRecognition();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition.continuous = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition.interimResults = true;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition.lang = 'id-ID';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition.onresult = function (event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let finalTranscript = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>for (let i = event.resultIndex; i &lt; event.results.length; i++) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>if (event.results[i].isFinal) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>finalTranscript += event.results[i][0].transcript;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (finalTranscript) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>document.getElementById('messageInput').value = finalTranscript;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>sendMessage();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>toggleVoiceMode();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition.start();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function stopVoiceRecognition() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (recognition) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition.stop();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>recognition = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Font Size Toggle</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function changeFontSize() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const fontSize = document.getElementById('fontSizeSelect').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let sizeClass;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (fontSize === 'sm') sizeClass = 'text-sm';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>else if (fontSize === 'lg') sizeClass = 'text-lg';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>else sizeClass = 'text-base';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// This is a simplified approach. For full control, you'd adjust paragraph tags etc.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>chatMessages.querySelectorAll('.ai-message p, .user-message p').forEach(p =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>p.style.fontSize = fontSize === 'sm' ? '0.8rem' : (fontSize === 'lg' ? '1.1rem' : '0.95rem');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>settings.fontSize = fontSize;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Theme Management</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function changeTheme(themeName) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>settings.theme = themeName;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll('.theme-option-new').forEach(btn =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>btn.classList.remove('active');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const selectedBtn = document.getElementById(`theme${themeName.charAt(0).toUpperCase() + themeName.slice(1)}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (selectedBtn) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>selectedBtn.classList.add('active');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const themeColors = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>blue: {from: '#667eea', to: '#764ba2'},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>green: {from: '#10b981', to: '#059669'},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>pink: {from: '#ec4899', to: '#dc2626'}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const colors = themeColors[themeName];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const header = document.querySelector('.header-gradient');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>header.style.background = `linear-gradient(135deg, ${colors.from}, ${colors.to})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll('.send-button').forEach(btn =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>btn.style.background = `linear-gradient(135deg, ${colors.from}, ${colors.to})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll('.ai-avatar').forEach(avatar =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>avatar.style.background = `linear-gradient(135deg, ${colors.from}, ${colors.to})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const profileAvatarBorder = document.querySelector('.profile-avatar-border');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (profileAvatarBorder) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>profileAvatarBorder.style.borderImage = `linear-gradient(135deg, ${colors.from}, ${colors.to}, #f093fb) 1`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Settings Management</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function loadSettings() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const savedSettings = localStorage.getItem('storybaliSettings');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (savedSettings) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>settings = { ...settings, ...JSON.parse(savedSettings) };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>applySettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function saveSettings() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Ambil nilai terbaru dari UI sebelum menyimpan</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>settings.voiceURI = document.getElementById('voiceSelect').value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>localStorage.setItem('storybaliSettings', JSON.stringify(settings));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function applySettings() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>changeTheme(settings.theme);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('soundToggle').checked = settings.soundEnabled;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('animationToggle').checked = settings.animationsEnabled;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('readAiResponseToggle').checked = settings.readAiResponseEnabled;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('aiNameInput').value = settings.aiName || 'Wayan AI';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('fontSizeSelect').value = settings.fontSize || 'base';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('personalitySelect').value = settings.personality || 'santai';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Terapkan pengaturan suara setelah daftar suara dimuat</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const voiceSelect = document.getElementById('voiceSelect');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (settings.voiceURI &amp;&amp; voiceSelect.options.length &gt; 1) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>voiceSelect.value = settings.voiceURI;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const currentRole = settings.aiRole || 'umum';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const aiRoleSelect = document.getElementById('aiRoleSelect');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const customRoleContainer = document.getElementById('customRoleContainer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const customRoleInput = document.getElementById('customRoleInput');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>aiRoleSelect.value = currentRole;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (currentRole === 'kustom') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>customRoleContainer.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>customRoleInput.value = settings.customAiRolePrompt || '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>customRoleContainer.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!settings.animationsEnabled) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>toggleAnimations();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function toggleSound() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>settings.soundEnabled = document.getElementById('soundToggle').checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function toggleReadAiResponse() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>settings.readAiResponseEnabled = document.getElementById('readAiResponseToggle').checked;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function clearChatHistory() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (confirm('Yakin mau hapus semua riwayat chat? Tindakan ini tidak bisa dibatalkan.')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>conversationHistory = [];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>localStorage.removeItem('storybaliConversationHistory');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const messages = chatMessages.querySelectorAll('.message-bubble, .system-message-bubble'); // also remove system messages</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>for (let i = messages.length - 1; i &gt; 0; i--) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>messages[i].remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>updateChatCount();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('Riwayat chat telah dihapus!');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// NEW: Function to switch settings tabs</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function switchSettingsTab(tabName) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll('.settings-tab').forEach(tab =&gt; tab.classList.remove('active'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelector(`.settings-tab[onclick="switchSettingsTab('${tabName}')"]`).classList.add('active');</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.querySelectorAll('.settings-tab-content').forEach(content =&gt; content.classList.remove('active'));</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById(`tab-${tabName}`).classList.add('active');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Modal Management</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function toggleSettings() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const modal = document.getElementById('settingsModal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const content = document.getElementById('settingsModalContent');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (modal.classList.contains('hidden')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>switchSettingsTab('general'); // Reset to general tab on open</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>modal.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; content.style.transform = 'scale(1)', 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>content.style.transform = 'scale(0.9)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; modal.classList.add('hidden'), 300);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function showProfileModal() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const modal = document.getElementById('profileModal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const content = document.getElementById('profileModalContent');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>modal.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; content.style.transform = 'scale(1)', 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function hideProfileModal() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const modal = document.getElementById('profileModal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const content = document.getElementById('profileModalContent');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>content.style.transform = 'scale(0.9)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; modal.classList.add('hidden'), 300);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Image Upload</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function triggerImageUpload() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('imageInput').click();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function handleImageUpload(event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const file = event.target.files[0];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (file) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const reader = new FileReader();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>reader.onload = function (e) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>showImagePreview(e.target.result, file.name);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>reader.readAsDataURL(file);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let currentPreviewImage = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>let currentPreviewFileName = null;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function showImagePreview(base64Image, fileName) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentPreviewImage = base64Image;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentPreviewFileName = fileName;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('previewImage').src = base64Image;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('previewFileName').textContent = `${fileName}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('imageQuestionInput').value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const modal = document.getElementById('imagePreviewModal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const content = document.getElementById('imagePreviewContent');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>modal.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; content.style.transform = 'scale(1)', 10);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; document.getElementById('imageQuestionInput').focus(), 300);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function hideImagePreview() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const modal = document.getElementById('imagePreviewModal');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const content = document.getElementById('imagePreviewContent');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>content.style.transform = 'scale(0.9)';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>modal.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('imageInput').value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>currentPreviewImage = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>currentPreviewFileName = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}, 300);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function sendImageWithQuestion() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const question = document.getElementById('imageQuestionInput').value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!question) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('Tulis pertanyaan dulu ya!');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.getElementById('imageQuestionInput').focus();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- MODIFIKASI: Pengecekan limit sebelum kirim gambar ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const allUserData = getChatLimitData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const userData = allUserData[currentUserIP] || { count: 0 };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (userData.count &gt;= CHAT_LIMIT) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>alert('Anda telah mencapai batas pengiriman pesan. Silakan tunggu cooldown selesai.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>hideImagePreview();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- AKHIR MODIFIKASI ---</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>hideImagePreview();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addImageMessageWithQuestion(currentPreviewImage, currentPreviewFileName, question, true);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>showImageProcessingIndicator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>analyzeImageWithQuestion(currentPreviewImage, question);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function addImageMessageWithQuestion(imageSrc, fileName, question, isUser = false) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const messageDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>messageDiv.className = 'message-bubble flex items-start space-x-3';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (isUser) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageDiv.className += ' flex-row-reverse space-x-reverse user';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center flex-shrink-0 shadow-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="user-message text-white rounded-2xl rounded-tr-md p-4 max-w-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img src="${imageSrc}" alt="${fileName}" class="w-full h-auto rounded-lg mb-2 max-h-32 object-cover shadow-sm"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-xs mb-2 opacity-90"&gt;${fileName}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="bg-white bg-opacity-20 rounded-lg p-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;p class="text-xs font-medium"&gt;${question}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>// --- MODIFIKASI: Perbarui hitungan setelah kirim gambar ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const allUserData = getChatLimitData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const userData = allUserData[currentUserIP] || { count: 0 };</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>userData.count++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>allUserData[currentUserIP] = userData;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveChatLimitData(allUserData);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (userData.count &gt;= CHAT_LIMIT) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const cooldownEndTime = new Date().getTime() + COOLDOWN_MINUTES * 60 * 1000;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>userData.cooldownUntil = cooldownEndTime;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>allUserData[currentUserIP] = userData;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>saveChatLimitData(allUserData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>startCooldown(cooldownEndTime);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// --- AKHIR MODIFIKASI ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const typingIndicator = document.getElementById('typingIndicator');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>chatMessages.insertBefore(messageDiv, typingIndicator);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scrollToBottom();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Message Management</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function handleKeyPress(event) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (event.key === 'Enter') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>sendMessage();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// START: PENAMBAHAN FUNGSI - Notifikasi Perubahan Mode AI</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function addSystemMessage(message) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const messageDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>messageDiv.className = 'system-message-bubble';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>messageDiv.innerHTML = `&lt;div class="system-message"&gt;${message}&lt;/div&gt;`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const typingIndicator = document.getElementById('typingIndicator');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>chatMessages.insertBefore(messageDiv, typingIndicator);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scrollToBottom();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// END: PENAMBAHAN FUNGSI - Notifikasi Perubahan Mode AI</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function addMessage(message, isUser = false, suggestions = []) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const messageDiv = document.createElement('div');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>messageDiv.className = 'message-bubble flex items-start space-x-3';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (isUser) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageDiv.className += ' flex-row-reverse space-x-reverse user';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center flex-shrink-0 shadow-lg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-4 h-4 text-white" fill="currentColor" viewBox="0 0 20 20"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="user-message text-white rounded-2xl rounded-tr-md p-4 max-w-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="leading-relaxed text-sm"&gt;${message}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// --- PERBAIKAN DIMULAI DI SINI ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Mengubah karakter baris baru (\n) menjadi tag &lt;br&gt; agar paragraf ditampilkan dengan benar.</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const formattedMessage = message.replace(/\n/g, '&lt;br&gt;');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// --- AKHIR PERBAIKAN ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const encodedMessage = btoa(encodeURIComponent(message)); // Gunakan pesan asli untuk fitur suara</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageDiv.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-avatar w-8 h-8 rounded-full flex items-center justify-center flex-shrink-0 overflow-hidden"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;img src="https://i.postimg.cc/Wz2Gmx8X/IMG-2621.jpg" alt="Wayan AI" class="w-full h-full object-cover"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="ai-message rounded-2xl rounded-tl-md p-4 max-w-xs relative group"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;p class="text-gray-800 leading-relaxed text-sm"&gt;${formattedMessage}&lt;/p&gt; &lt;!-- Menggunakan pesan yang sudah diformat --&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;div class="mt-3"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>${renderSuggestions(suggestions)}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;button onclick="readAiResponse(this, '${encodedMessage}')" class="absolute bottom-2 right-2 w-6 h-6 bg-gray-200 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors duration-200 ease-in-out transform hover:scale-110 active:scale-90" title="Baca Jawaban"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.647 11 4.101 11 5v14c0 .899-.077 1.353-.293 1.569l-4.707-4.707z"&gt;&lt;/path&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messageDiv.querySelector('.ai-message').innerHTML += `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;button onclick="copyToClipboard(this.previousElementSibling.previousElementSibling.previousElementSibling.textContent, this)" class="copy-button absolute bottom-2 right-9 w-6 h-6 bg-gray-200 text-gray-600 rounded-full flex items-center justify-center hover:bg-gray-300 transition-colors duration-200 ease-in-out transform hover:scale-110 active:scale-90 opacity-0 group-hover:opacity-100 transition-opacity" title="Salin Jawaban"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"&gt;&lt;/path&gt;&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/button&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const typingIndicator = document.getElementById('typingIndicator');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>chatMessages.insertBefore(messageDiv, typingIndicator);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scrollToBottom();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function renderSuggestions(suggestionsArray) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (suggestionsArray &amp;&amp; suggestionsArray.length &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;div class="flex flex-wrap gap-2 mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>${suggestionsArray.map(suggestion =&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>`&lt;button onclick="sendQuickMessage('${suggestion.replace(/'/g, "\\'")}')" class="suggestion-btn px-3 py-1 text-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>${suggestion}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>&lt;/button&gt;`</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>).join('')}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return generateDefaultSuggestions();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function generateDefaultSuggestions() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const suggestions = [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>"Ceritakan lebih detail dong!",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>"Ada contoh lainnya?",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>"Apa tema undangan yang tersedia di StoryBali?",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>"Berapa harga undangan digital di StoryBali?",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>"Bagaimana cara memesan undangan untuk pernikahan?",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>"Apa keunggulan undangan StoryBali dibandingkan yang lain?"</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const randomSuggestions = suggestions.sort(() =&gt; 0.5 - Math.random()).slice(0, 2);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;div class="flex flex-wrap gap-2 mt-2"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>${randomSuggestions.map(suggestion =&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>`&lt;button onclick="sendQuickMessage('${suggestion}')" class="suggestion-btn px-3 py-1 text-xs"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>${suggestion}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;/button&gt;`</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>).join('')}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>&lt;/div&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function showTypingIndicator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('typingIndicator').classList.add('show');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scrollToBottom();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function hideTypingIndicator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('typingIndicator').classList.remove('show');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function showImageProcessingIndicator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('imageProcessingIndicator').classList.add('show');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>scrollToBottom();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function hideImageProcessingIndicator() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('imageProcessingIndicator').classList.remove('show');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function scrollToBottom() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>chatMessages.scrollTo({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>top: chatMessages.scrollHeight,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>behavior: 'smooth'</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}, 100);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function playNotificationSound() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (settings.soundEnabled) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>const audioContext = new (window.AudioContext || window.webkitAudioContext)();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const oscillator = audioContext.createOscillator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const gainNode = audioContext.createGain();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>oscillator.connect(gainNode);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>gainNode.connect(audioContext.destination);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>oscillator.frequency.value = 800;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>oscillator.type = 'sine';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>oscillator.start(audioContext.currentTime);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>oscillator.stop(audioContext.currentTime + 0.3);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Copy to Clipboard</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function copyToClipboard(text, buttonElement) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>navigator.clipboard.writeText(text).then(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const originalText = buttonElement.innerHTML;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>buttonElement.innerHTML = `</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"&gt;&lt;/path&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>&lt;/svg&gt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>buttonElement.title = 'Copied!';</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>buttonElement.innerHTML = originalText;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>buttonElement.title = 'Copy to Clipboard';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}, 2000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}).catch(err =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.error('Failed to copy: ', err);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('Gagal menyalin teks.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// START: FUNGSI BARU DAN MODIFIKASI UNTUK PEMILIHAN SUARA</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Fungsi untuk mengisi dropdown dengan suara yang tersedia</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function populateVoiceList() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const voices = speechSynthesis.getVoices();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const voiceSelect = document.getElementById('voiceSelect');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const savedVoiceURI = settings.voiceURI; // Ambil URI yang tersimpan</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>voiceSelect.innerHTML = ''; // Kosongkan pilihan lama</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Tambahkan pilihan default</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const defaultOption = document.createElement('option');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>defaultOption.textContent = 'Default Browser';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>defaultOption.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>voiceSelect.appendChild(defaultOption);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (voices.length === 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>voiceSelect.options[0].textContent = 'Tidak ada suara';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Prioritaskan suara Indonesia</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const idVoices = voices.filter(voice =&gt; voice.lang === 'id-ID');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const otherVoices = voices.filter(voice =&gt; voice.lang !== 'id-ID');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Buat grup untuk suara Indonesia</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (idVoices.length &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const idGroup = document.createElement('optgroup');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>idGroup.label = 'Bahasa Indonesia';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>idVoices.forEach(voice =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const option = document.createElement('option');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>option.textContent = `${voice.name} (${voice.lang})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>option.value = voice.voiceURI;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>idGroup.appendChild(option);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>voiceSelect.appendChild(idGroup);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Buat grup untuk suara lainnya</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (otherVoices.length &gt; 0) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">             </span>const otherGroup = document.createElement('optgroup');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>otherGroup.label = 'Bahasa Lain';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>otherVoices.forEach(voice =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const option = document.createElement('option');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>option.textContent = `${voice.name} (${voice.lang})`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>option.value = voice.voiceURI;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>otherGroup.appendChild(option);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>voiceSelect.appendChild(otherGroup);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Coba pilih kembali suara yang sudah disimpan</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (savedVoiceURI) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>voiceSelect.value = savedVoiceURI;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Fungsi pembaca respons AI yang sudah dimodifikasi</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function readAiResponse(buttonElement, encodedMessage) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!settings.readAiResponseEnabled) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('Fitur pembaca jawaban AI dinonaktifkan di pengaturan.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const message = decodeURIComponent(atob(encodedMessage));</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (isReading) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>stopReading();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>buttonElement.innerHTML = `&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.647 11 4.101 11 5v14c0 .899-.077 1.353-.293 1.569l-4.707-4.707z"&gt;&lt;/path&gt;&lt;/svg&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>isReading = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (currentUtterance) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>speechSynthesis.cancel();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentUtterance = new SpeechSynthesisUtterance(message);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- LOGIKA BARU: Terapkan suara yang dipilih ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const selectedVoiceURI = settings.voiceURI;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const voices = speechSynthesis.getVoices();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const selectedVoice = voices.find(voice =&gt; voice.voiceURI === selectedVoiceURI);</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (selectedVoice) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>currentUtterance.voice = selectedVoice;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Jika suara yang dipilih tidak ada, gunakan default untuk bahasa Indonesia</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const idVoiceDefault = voices.find(voice =&gt; voice.lang === 'id-ID');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if(idVoiceDefault) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">               </span>currentUtterance.voice = idVoiceDefault;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- AKHIR LOGIKA BARU ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentUtterance.rate = 1.0;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentUtterance.pitch = 1.0;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>buttonElement.innerHTML = `&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0zM9 10a1 1 0 011-1h4a1 1 0 011 1v4a1 1 0 01-1 1h-4a1 1 0 01-1-1v-4z"&gt;&lt;/path&gt;&lt;/svg&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>isReading = true;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentUtterance.onend = () =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>buttonElement.innerHTML = `&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.647 11 4.101 11 5v14c0 .899-.077 1.353-.293 1.569l-4.707-4.707z"&gt;&lt;/path&gt;&lt;/svg&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>isReading = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>currentUtterance = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentUtterance.onerror = (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>console.error('SpeechSynthesisUtterance.onerror', event);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert('Maaf, tidak dapat membaca teks. Error: ' + event.error);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>buttonElement.innerHTML = `&lt;svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"&gt;&lt;path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.647 11 4.101 11 5v14c0 .899-.077 1.353-.293 1.569l-4.707-4.707z"&gt;&lt;/path&gt;&lt;/svg&gt;`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>isReading = false;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>currentUtterance = null;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>speechSynthesis.speak(currentUtterance);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">    </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// END: FUNGSI BARU DAN MODIFIKASI UNTUK PEMILIHAN SUARA</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// =================================================================</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function stopReading() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (speechSynthesis.speaking) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>speechSynthesis.cancel();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>function getSystemPrompt() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const aiName = settings.aiName || 'Wayan';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const baseInstructions = `Selalu berikan jawabanmu terlebih dahulu. Setelah jawaban utama selesai, berikan 2 atau 3 saran pertanyaan lanjutan yang relevan. Format saran: pisahkan jawaban utama dan saran dengan '[SUGGESTIONS]', dan pisahkan setiap saran dengan tanda pipa '|'.`;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const rolePrompts = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>guru_jepang: `Kamu adalah seorang guru Bahasa Jepang profesional bernama Tanaka-sensei. Gaya bicaramu sabar, mendidik, dan ramah. Sapa pengguna dengan "Konnichiwa, gakusei-san!" (Halo, murid!). Gunakan huruf Jepang (Hiragana, Katakana, Kanji) beserta romaji dan artinya saat mengajarkan kosakata atau kalimat. Koreksi kesalahan pengguna dengan lembut dan berikan penjelasan tata bahasa yang jelas. Selalu berikan contoh kalimat untuk setiap konsep yang diajarkan. Kamu juga bisa menyisipkan fakta budaya Jepang yang relevan.`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>guru_matematika: `Kamu adalah seorang guru Matematika yang handal dan bisa membuat konsep sulit menjadi mudah dimengerti. Gaya bicaramu logis, terstruktur, dan suportif. Jelaskan setiap langkah pemecahan masalah secara rinci. Gunakan analogi sederhana jika memungkinkan. Jangan hanya memberikan jawaban akhir, tapi pandu pengguna melalui proses berpikir untuk sampai ke jawaban tersebut.`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>dokter: `Kamu adalah AI yang berperan sebagai Dokter Umum virtual yang informatif dan empatik. Mulai percakapan dengan sapaan yang menenangkan. Berikan informasi medis yang akurat dan berbasis bukti, namun SELALU awali dan akhiri jawabanmu dengan disclaimer penting: "Informasi ini bersifat edukatif dan tidak menggantikan konsultasi medis profesional. Segera kunjungi dokter atau fasilitas kesehatan terdekat untuk diagnosis dan penanganan yang tepat." Jangan pernah memberikan diagnosis atau resep. Fokus pada penjelasan kondisi medis, gejala umum, dan pilihan gaya hidup sehat.`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>programmer: `Kamu adalah seorang senior programmer yang sangat berpengalaman dan suka membantu (coding buddy). Gaya bicaramu to-the-point, efisien, dan jelas. Saat pengguna memberikan kode, identifikasi bug, tawarkan optimisasi, dan jelaskan 'mengapa' perbaikanmu lebih baik. Berikan contoh kode yang bersih dan terdokumentasi dengan baik. Selalu tanyakan bahasa pemrograman apa yang digunakan jika tidak disebutkan.`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>penerjemah: `Kamu adalah seorang penerjemah multibahasa yang sangat akurat. Fokus utamamu adalah menerjemahkan teks dari satu bahasa ke bahasa lain. Saat pengguna memberikan teks, deteksi bahasa aslinya dan tanyakan ke bahasa apa mereka ingin menerjemahkannya. Berikan terjemahan literal dan juga terjemahan kontekstual jika diperlukan, serta jelaskan nuansa budaya atau idiom yang mungkin hilang dalam terjemahan.`,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>};</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>let roleInstruction = '';</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (settings.aiRole === 'kustom' &amp;&amp; settings.customAiRolePrompt) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>roleInstruction = settings.customAiRolePrompt;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else if (rolePrompts[settings.aiRole]) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>roleInstruction = rolePrompts[settings.aiRole];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>switch (settings.personality) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>case 'profesional':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>roleInstruction = `Kamu adalah ${aiName}, asisten AI yang profesional, formal, dan terstruktur.`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>case 'lucu':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>roleInstruction = `Kamu adalah ${aiName}, asisten AI yang humoris dan kreatif. Sisipkan lelucon jika relevan.`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>case 'santai':</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>default:</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>roleInstruction = `Kamu adalah ${aiName}, asisten AI dari StoryBali yang santai, friendly, dan menggunakan bahasa sehari-hari.`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>break;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>return `${roleInstruction} ${baseInstructions}`;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// AI Communication</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>async function sendMessage() {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const input = document.getElementById('messageInput');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const message = input.value.trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!message) return;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- START: MODIFIKASI UNTUK BATAS CHAT ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!currentUserIP) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>alert("Harap tunggu sebentar, sedang mengidentifikasi sesi Anda.");</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const allUserData = getChatLimitData();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const userData = allUserData[currentUserIP] || { count: 0 };</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (userData.count &gt;= CHAT_LIMIT) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!userData.cooldownUntil) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>// Mulai cooldown jika belum ada</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const cooldownEndTime = new Date().getTime() + COOLDOWN_MINUTES * 60 * 1000;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>userData.cooldownUntil = cooldownEndTime;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>allUserData[currentUserIP] = userData;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>saveChatLimitData(allUserData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>startCooldown(cooldownEndTime);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return; // Hentikan pengiriman pesan jika limit tercapai</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Tingkatkan hitungan</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>userData.count++;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>allUserData[currentUserIP] = userData;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>saveChatLimitData(allUserData);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- END: MODIFIKASI UNTUK BATAS CHAT ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addMessage(message, true);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>addToConversationHistory('user', message);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>input.value = '';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>showTypingIndicator();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- START: MODIFIKASI - Mulai cooldown jika pesan ke-5 dikirim ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (userData.count &gt;= CHAT_LIMIT) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const cooldownEndTime = new Date().getTime() + COOLDOWN_MINUTES * 60 * 1000;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>userData.cooldownUntil = cooldownEndTime;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>allUserData[currentUserIP] = userData;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveChatLimitData(allUserData);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>// Tunda aktivasi cooldown sedikit agar AI sempat merespons</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>setTimeout(() =&gt; startCooldown(cooldownEndTime), 1000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- END: MODIFIKASI ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const apiUrl = getApiUrl();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!apiUrl) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>hideTypingIndicator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addMessage('Maaf, tidak ada API Key yang valid untuk digunakan. Silakan periksa pengaturan API Key Anda.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const contents = [...conversationHistory];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const systemPromptText = getSystemPrompt();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const systemPrompt = {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>role: "user",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>parts: [{ text: systemPromptText }]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>};</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">            </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const response = await fetch(apiUrl, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>headers: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>'Content-Type': 'application/json',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>body: JSON.stringify({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>contents: [systemPrompt, ...contents],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>generationConfig: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>temperature: 0.9,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>topK: 1,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>topP: 1,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>maxOutputTokens: 2048,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>hideTypingIndicator();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!response.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>let specificErrorMessage = 'Terjadi kesalahan yang tidak diketahui.';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (response.status === 400) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>specificErrorMessage = 'Permintaan tidak valid. Mungkin ada masalah dengan format pesan.';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else if (response.status === 401 || response.status === 403 || response.status === 429) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>specificErrorMessage = 'API Key bermasalah (limit atau tidak valid). Mencoba API Key acak lainnya...';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>// Coba kirim lagi, fungsi getApiUrl akan mengambil kunci acak baru</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>setTimeout(() =&gt; sendMessage(), 1000);<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else if (response.status &gt;= 500) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>specificErrorMessage = 'Terjadi masalah di server AI. Coba lagi beberapa saat.';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>throw new Error(`HTTP error! status: ${response.status}. ${specificErrorMessage}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const data = await response.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (data.candidates &amp;&amp; data.candidates[0] &amp;&amp; data.candidates[0].content &amp;&amp; data.candidates[0].content.parts) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let aiResponseText = data.candidates[0].content.parts[0].text;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let mainAnswer = aiResponseText;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let dynamicSuggestions = [];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (aiResponseText.includes('[SUGGESTIONS]')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const parts = aiResponseText.split('[SUGGESTIONS]');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>mainAnswer = parts[0].trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>dynamicSuggestions = parts[1].split('|').map(s =&gt; s.trim()).filter(s =&gt; s);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addToConversationHistory('model', mainAnswer);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addMessage(mainAnswer, false, dynamicSuggestions);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>playNotificationSound();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>const defaultMessage = 'Maaf, Wayan tidak dapat memberikan respons untuk pertanyaan ini. Silakan coba pertanyaan lain.';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addMessage(defaultMessage);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>hideTypingIndicator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let displayMessage = `Aduh, Wayan error nih: ${error.message}. Coba lagi ya!`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (error.message.includes('HTTP error!')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>displayMessage = error.message.replace('HTTP error! status: ', 'Kesalahan API (Kode ');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>displayMessage = displayMessage.replace('. ', '). ');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else if (error.name === 'TypeError' &amp;&amp; error.message.includes('Failed to fetch')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>displayMessage = 'Wayan tidak bisa terhubung ke internet. Coba periksa koneksi kamu ya!';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addMessage(displayMessage);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>async function analyzeImageWithQuestion(base64Image, userQuestion) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const apiUrl = getApiUrl();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (!apiUrl) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>hideImageProcessingIndicator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addMessage('Maaf, tidak ada API Key yang valid untuk digunakan. Silakan periksa pengaturan API Key Anda.');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>return;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>try {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const imageData = base64Image.split(',')[1];</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const systemPromptText = getSystemPrompt();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const promptText = `Ini adalah instruksi sistemmu: "${systemPromptText}". Sekarang, seorang user bertanya: "${userQuestion}". Jawab pertanyaan user tentang gambar ini berdasarkan instruksi sistemmu.`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const response = await fetch(apiUrl, {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>method: 'POST',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>headers: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>'Content-Type': 'application/json',</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>},</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>body: JSON.stringify({</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>contents: [{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>parts: [</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>{ text: promptText },</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>{</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>inline_data: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>mime_type: "image/jpeg",</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                    </span>data: imageData</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>]</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}],</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>generationConfig: {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>temperature: 0.9,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>topK: 32,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>topP: 1,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                        </span>maxOutputTokens: 2048,</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>})</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>hideImageProcessingIndicator();</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (!response.ok) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                 </span>let specificErrorMessage = 'Terjadi kesalahan yang tidak diketahui.';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (response.status === 400) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>specificErrorMessage = 'Permintaan tidak valid. Mungkin ada masalah dengan format gambar atau pertanyaan.';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else if (response.status === 401 || response.status === 403 || response.status === 429) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>specificErrorMessage = 'API Key bermasalah (limit atau tidak valid). Mencoba API Key acak lainnya...';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>setTimeout(() =&gt; analyzeImageWithQuestion(base64Image, userQuestion), 1000);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>return;<span class="Apple-converted-space"> </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>} else if (response.status &gt;= 500) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>specificErrorMessage = 'Terjadi masalah di server AI. Coba lagi beberapa saat.';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>throw new Error(`HTTP error! status: ${response.status}. ${specificErrorMessage}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const data = await response.json();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (data.candidates &amp;&amp; data.candidates[0] &amp;&amp; data.candidates[0].content &amp;&amp; data.candidates[0].content.parts) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let aiResponseText = data.candidates[0].content.parts[0].text;</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let mainAnswer = aiResponseText;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>let dynamicSuggestions = [];</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (aiResponseText.includes('[SUGGESTIONS]')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>const parts = aiResponseText.split('[SUGGESTIONS]');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>mainAnswer = parts[0].trim();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                    </span>dynamicSuggestions = parts[1].split('|').map(s =&gt; s.trim()).filter(s =&gt; s);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">                </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addToConversationHistory('model', mainAnswer);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addMessage(mainAnswer, false, dynamicSuggestions);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>playNotificationSound();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addMessage('Wah, gue ga bisa analisis gambar ini nih. Coba upload gambar lain ya!');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>} catch (error) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>hideImageProcessingIndicator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>let displayMessage = `Aduh, Wayan error nih waktu analisis gambar: ${error.message}. Coba lagi ya!`;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (error.message.includes('HTTP error!')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>displayMessage = error.message.replace('HTTP error! status: ', 'Kesalahan API (Kode ');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>displayMessage = displayMessage.replace('. ', '). ');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else if (error.name === 'TypeError' &amp;&amp; error.message.includes('Failed to fetch')) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>displayMessage = 'Wayan tidak bisa terhubung ke internet. Coba periksa koneksi kamu ya!';</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addMessage(displayMessage);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Initialize</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>window.addEventListener('load', async () =&gt; { // --- MODIFIKASI: Menjadikan fungsi async ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loadApiKeys();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loadSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateApiStatus();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- START: MODIFIKASI UNTUK FITUR BATAS CHAT ---</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>currentUserIP = await getUserIP(); // Dapatkan IP saat memuat</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>checkUserStatus(); // Cek status cooldown pengguna</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// --- END: MODIFIKASI ---</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Panggil populateVoiceList setelah load dan juga pasang listener</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>populateVoiceList();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>if (speechSynthesis.onvoiceschanged !== undefined) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>speechSynthesis.onvoiceschanged = populateVoiceList;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const chatMessages = document.getElementById('chatMessages');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const messages = chatMessages.querySelectorAll('.message-bubble');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>for (let i = messages.length - 1; i &gt; 0; i--) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>messages[i].remove();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>loadConversationHistory();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>updateChatCount();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>hideTypingIndicator();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>hideImageProcessingIndicator();</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('aiNameInput').addEventListener('change', (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>settings.aiName = event.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>document.querySelector('.header-gradient h1').textContent = settings.aiName;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('fontSizeSelect').addEventListener('change', changeFontSize);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('saveHistoryToggle').addEventListener('change', saveSettings);</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('personalitySelect').addEventListener('change', (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const selectedText = event.target.options[event.target.selectedIndex].text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>settings.personality = event.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addSystemMessage(`Gaya bahasa AI diubah menjadi: ${selectedText}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const aiRoleSelect = document.getElementById('aiRoleSelect');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const customRoleContainer = document.getElementById('customRoleContainer');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>const customRoleInput = document.getElementById('customRoleInput');</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>aiRoleSelect.addEventListener('change', (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const selectedRole = event.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>const selectedText = event.target.options[event.target.selectedIndex].text;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>settings.aiRole = selectedRole;</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (selectedRole === 'kustom') {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>customRoleContainer.classList.remove('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>} else {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>customRoleContainer.classList.add('hidden');</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>addSystemMessage(`Mode peran AI diubah menjadi: ${selectedText}`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>customRoleInput.addEventListener('change', (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>settings.customAiRolePrompt = event.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>addSystemMessage(`Mode peran kustom AI telah ditetapkan.`);</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"><span class="Apple-converted-space">        </span></span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>// Listener untuk dropdown suara baru</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById('voiceSelect').addEventListener('change', (event) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>settings.voiceURI = event.target.value;</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>saveSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Close modals on outside click</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>['profileModal', 'imagePreviewModal', 'settingsModal'].forEach(modalId =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>document.getElementById(modalId).addEventListener('click', (e) =&gt; {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>if (e.target.id === modalId) {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>if (modalId === 'profileModal') hideProfileModal();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>else if (modalId === 'imagePreviewModal') hideImagePreview();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">                </span>else if (modalId === 'settingsModal') toggleSettings();</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">            </span>}</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">        </span>});</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>});</span></p>
<p class="p2"><span class="s1"></span><br></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>// Prevent zoom on input focus (iOS)</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>document.addEventListener('touchstart', function () {</span></p>
<p class="p1"><span class="s1"><span class="Apple-converted-space">    </span>}, true);</span></p>
<p class="p1"><span class="s1">&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;/body&gt;</span></p>
<p class="p1"><span class="s1">&lt;/html&gt;</span></p>
</body>
</html>
